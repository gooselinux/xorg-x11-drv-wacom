From ed0b6c4a874e29286848bd9ec674d28be89af818 Mon Sep 17 00:00:00 2001
From: Peter Hutterer <peter.hutterer@who-t.net>
Date: Wed, 27 Oct 2010 16:19:56 +1000
Subject: [PATCH] When updating a button action property, always update all of them.

Otherwise, unsetting a property is impossible.

Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
---
 src/wcmXCommand.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/wcmXCommand.c b/src/wcmXCommand.c
index 107d86f..bc72dc1 100644
--- a/src/wcmXCommand.c
+++ b/src/wcmXCommand.c
@@ -638,18 +638,18 @@ int wcmSetProperty(DeviceIntPtr dev, Atom property, XIPropertyValuePtr prop,
 			for (i = 0; i < prop->size; i++)
 				priv->btn_actions[i] = values[i];
 
-			for (i = 0; i < prop->size; i++)
+			for (i = 0; i < ARRAY_SIZE(priv->keys); i++)
 			{
-				if (!values[i])
+				memset(priv->keys[i], 0, sizeof(priv->keys[i]));
+
+				if (i >= prop->size || !values[i])
 					continue;
 
 				XIGetDeviceProperty(local->dev, values[i], &val);
 
-				memset(priv->keys[i], 0, sizeof(priv->keys[i]));
 				for (j = 0; j < val->size; j++)
 					priv->keys[i][j] = ((unsigned int*)val->data)[j];
 			}
-
 		}
 	} else
 	{
-- 
1.7.1

